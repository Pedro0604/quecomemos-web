@if (carrito && carrito.items.length > 0) {
  <div class="carrito-container">
    <button mat-stroked-button color="warn" (click)="vaciarCarrito()">
      Vaciar carrito
    </button>
    <table mat-table [dataSource]="carrito.items" class="mat-elevation-z1 full-width">
      <!-- Tipo -->
      <ng-container matColumnDef="tipo">
        <th mat-header-cell *matHeaderCellDef> Tipo</th>
        <td mat-cell *matCellDef="let item">
          <mat-chip selected [disableRipple]="true">
            {{ capitalize(getEntidadNombre(item.item.tipo)) }}
          </mat-chip>
        </td>
      </ng-container>

      <!-- Nombre -->
      <ng-container matColumnDef="nombre">
        <th mat-header-cell *matHeaderCellDef> Nombre</th>
        <td mat-cell *matCellDef="let item"> {{ item.item.nombre }}</td>
      </ng-container>

      <!-- Cantidad -->
      <ng-container matColumnDef="cantidad">
        <th mat-header-cell *matHeaderCellDef> Cantidad</th>
        <td mat-cell *matCellDef="let item">
          @if (authService.hasPermission(Accion.EDITAR, Entidad.ITEM_PEDIDO)) {
            <app-cantidad [cantidad]="item.cantidad" [loading]="item.loading"
                          (cantidadChange)="onCantidadChange(item, $event)"/>
          } @else {
            <span>{{ item.cantidad }}</span>
          }
        </td>
      </ng-container>

      <!-- Precio unitario -->
      <ng-container matColumnDef="precioUnitario">
        <th mat-header-cell *matHeaderCellDef> Precio Unit.</th>
        <td mat-cell *matCellDef="let item"> {{ item.precioUnitario | currency:'$':'symbol':'1.0-0' }}</td>
      </ng-container>

      <!-- Subtotal -->
      <ng-container matColumnDef="subtotal">
        <th mat-header-cell *matHeaderCellDef> Subtotal</th>
        <td mat-cell *matCellDef="let item"> {{ item.subtotal | currency:'$':'symbol':'1.0-0' }}</td>
      </ng-container>

      <!-- Acciones -->
      <ng-container matColumnDef="acciones">
        <th mat-header-cell *matHeaderCellDef></th>
        <td mat-cell *matCellDef="let item">
          @if (authService.hasPermission(Accion.EDITAR, Entidad.ITEM_PEDIDO)) {
            <button
              mat-icon-button
              color="warn"
              (click)="eliminarItem(item)"
              [disabled]="item.loading"
              matTooltip="Eliminar del carrito"
              matTooltipShowDelay="500"
            >
              <mat-icon>delete</mat-icon>
            </button>
          }
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
    </table>

    <div class="total-row">
      <span>Total:</span>
      <span class="total-amount">
      {{ carrito.total | currency:'$':'symbol':'1.0-0' }}
    </span>
    </div>
  </div>

  <div style="display: flex; justify-content: flex-end; margin-top: 1rem;">
    <a mat-raised-button routerLink="/pagar"> Finalizar compra </a>
  </div>
} @else {
  <p>No hay items en el carrito.</p>
}
