<app-title showVegetariano showVolver [title]="title()"/>

<!--Template para definir la opción del autocomplete de Menú -->
<ng-template
  #menuTemplate
  let-opcion>
            <span class="flex items-center gap-4">
              <span class="flex items-center">
                <span>{{ opcion.nombre }}</span>
                @if (opcion.vegetariano) {
                  <mat-icon class="text-green-600">eco</mat-icon>
                }
              </span>
            </span>
</ng-template>

<app-form [form]="form" (submit)="onSubmit()">
  <app-select
    label="Día del Menú Diario"
    [abstractControl]="form.get('dia')"
    placeholder="Seleccione un día para el menú diario"
    [opciones]="diasDeSemanaOptions"
  />
  <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
    @for (campo of camposDeMenus; track campo.nombre) {
      <app-autocomplete
        [label]="loading ? 'Cargando...' : campo.label"
        [abstractControl]="form.get(campo.nombre)"
        [opciones]="campo.menus"
        [placeholder]="('Seleccioná un ' + campo.label.toLowerCase())"
        [displayWithFn]="displayFn"
        [optionTemplate]="menuTemplate"
      />
    }
  </div>
  <app-form-state [loading]="loading" [error]="error">
    @if (relatedData.length === 0) {
      <mat-error>No hay ningún menú</mat-error>
      <a routerLink="/menu/create" mat-button class="-ms-3">Creá alguno para poder continuar</a>
    } @else {
      @for (campo of camposDeMenus; track campo.nombre) {
        @if (campo.menus.length === 0) {
          <mat-error>No hay ningún menú {{ campo.vegetariano ? '' : 'no ' }}vegetariano</mat-error>
          <a routerLink="/menu/create" [queryParams]="campo.vegetariano ? { vegetariano: campo.vegetariano } : {}"
             mat-button class="-ms-3">Creá alguno para poder continuar</a>
        }
      }
    }
  </app-form-state>
  <app-submit-button [form]="form" [pendingText]="submittingText()" [error]="error" [loading]="loading">{{ title() }}</app-submit-button>
</app-form>
