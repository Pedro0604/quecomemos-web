<div style="max-width: 500px; margin: 0 auto; padding: 24px;">
  <h2 style="text-align: center;">Resumen de pago</h2>

  <!-- Total -->
  <div style="margin-bottom: 16px;">
    <label style="font-weight: bold;">Total de la compra:</label>
    <div style="font-size: 1.2rem; margin-top: 4px;">
      {{ carrito?.total | currency:'$':'symbol':'1.0-0' }}
    </div>
  </div>

  <!-- Método de pago -->
  <div style="margin-bottom: 16px;">
    <label for="metodoPago" style="font-weight: bold;">Método de pago:</label>
    <mat-form-field appearance="fill" style="width: 100%; margin-top: 4px;">
      <mat-label>Seleccione un método</mat-label>
      <mat-select id="metodoPago" [(value)]="metodoSeleccionado" required>
        <mat-option *ngFor="let metodo of metodosDePago" [value]="metodo">
          {{ metodo }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Formulario -->
  <form #pagoForm="ngForm" style="margin-bottom: 24px;">
    <!-- CREDITO o DEBITO -->
    <div *ngIf="metodoSeleccionado === 'CREDITO' || metodoSeleccionado === 'DEBITO'">
      <mat-form-field appearance="fill" style="width: 100%; margin-bottom: 12px;">
        <mat-label>Titular de la tarjeta</mat-label>
        <input matInput required [(ngModel)]="datosPago.titular" name="titular" #titular="ngModel" />
      </mat-form-field>

      <!-- Número de tarjeta -->
      <mat-form-field appearance="fill" style="width: 100%; margin-bottom: 4px;">
        <mat-label>Número de tarjeta</mat-label>
        <input
          matInput
          required
          pattern="[0-9]{16}"
          maxlength="16"
          [(ngModel)]="datosPago.numeroTarjeta"
          name="numeroTarjeta"
          #numeroTarjeta="ngModel"
        />
      </mat-form-field>
      <div *ngIf="datosPago.numeroTarjeta?.length < 16" style="font-size: 12px; color: gray; margin-bottom: 12px;">
        Faltan {{ 16 - (datosPago.numeroTarjeta?.length || 0) }} caracteres
      </div>

      <!-- Código de seguridad -->
      <mat-form-field appearance="fill" style="width: 100%; margin-bottom: 4px;">
        <mat-label>Código de seguridad</mat-label>
        <input
          matInput
          required
          pattern="[0-9]{3,4}"
          maxlength="4"
          [(ngModel)]="datosPago.codigo"
          name="codigo"
          #codigo="ngModel"
        />
      </mat-form-field>
      <div *ngIf="datosPago.codigo?.length < 3" style="font-size: 12px; color: gray; margin-bottom: 12px;">
        Faltan {{ 3 - (datosPago.codigo?.length || 0) }} caracteres
      </div>
      <div *ngIf="datosPago.codigo?.length === 3 || datosPago.codigo?.length === 4" style="font-size: 12px; color: gray; margin-bottom: 12px;">
        Código válido
      </div>

    </div>

    <!-- MERCADO PAGO o CUENTA DNI -->
    <div *ngIf="metodoSeleccionado === 'MERCADO_PAGO' || metodoSeleccionado === 'CUENTA_DNI'">
      <mat-form-field appearance="fill" style="width: 100%; margin-bottom: 12px;">
        <mat-label>Titular de la cuenta</mat-label>
        <input matInput required [(ngModel)]="datosPago.titular" name="titularCuenta" #titularCuenta="ngModel" />
      </mat-form-field>

      <p style="font-style: italic; margin-top: 8px;">
        Vas a transferir a <strong>buffet.info.unlp</strong>
      </p>
    </div>
  </form>

  <!-- Botón pagar -->
  <button
    mat-raised-button
    color="primary"
    style="width: 100%;"
    (click)="pagar()"
    [disabled]="!metodoSeleccionado || !formularioValido()"
  >
    Pagar
  </button>
</div>
